<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoMunity - Scambio Etico e Comunitario</title>
<// ... (codice prima di questo blocco, attorno a riga 89) ...

  // NUOVA FUNZIONE: per cambiare tra scheda Beni e Servizi sulla Home
  window.switchHomeTab = function(type, element) {
    // Nasconde tutti i contenuti della Home Tab
    document.querySelectorAll('.home-tab-content').forEach(content => {
      content.classList.add('hidden');
      content.classList.remove('active');
    });
    
    // Rimuove la classe attiva da tutti i bottoni della barra
    // Ora gestisce la rimozione del BLU e del VERDE
    document.getElementById('tab-btn-beni').classList.remove('bg-blue-500', 'text-white');
    document.getElementById('tab-btn-servizi').classList.remove('bg-[#22c55e]', 'text-white'); 
    
    document.getElementById('tab-btn-beni').classList.add('text-gray-700', 'hover:bg-gray-200');
    document.getElementById('tab-btn-servizi').classList.add('text-gray-700', 'hover:bg-gray-200');

    // Mostra il contenuto corretto
    document.getElementById('home-' + type).classList.remove('hidden');
    document.getElementById('home-' + type).classList.add('active');

    // Applica lo stile attivo al bottone
    element.classList.remove('text-gray-700', 'hover:bg-gray-200');
    
    // LOGICA CORRETTA PER I NUOVI COLORI
    if (type === 'beni') {
        // Applica il BLU per i Beni (come il riquadro)
        element.classList.add('bg-blue-500', 'text-white');
    } else if (type === 'servizi') {
        // Applica il VERDE per i Servizi (come il riquadro)
        element.classList.add('bg-[#22c55e]', 'text-white');
    }
  }

// ... (codice dopo questo blocco, attorno a riga 117) ...
// ... (codice prima di questo blocco, attorno a riga 89) ...

  // NUOVA FUNZIONE: per cambiare tra scheda Beni e Servizi sulla Home
  window.switchHomeTab = function(type, element) {
    // Nasconde tutti i contenuti della Home Tab
    document.querySelectorAll('.home-tab-content').forEach(content => {
      content.classList.add('hidden');
      content.classList.remove('active');
    });
    
    // Rimuove la classe attiva da tutti i bottoni della barra
    // Ora gestisce la rimozione del BLU e del VERDE
    document.getElementById('tab-btn-beni').classList.remove('bg-blue-500', 'text-white');
    document.getElementById('tab-btn-servizi').classList.remove('bg-[#22c55e]', 'text-white'); 
    
    document.getElementById('tab-btn-beni').classList.add('text-gray-700', 'hover:bg-gray-200');
    document.getElementById('tab-btn-servizi').classList.add('text-gray-700', 'hover:bg-gray-200');

    // Mostra il contenuto corretto
    document.getElementById('home-' + type).classList.remove('hidden');
    document.getElementById('home-' + type).classList.add('active');

    // Applica lo stile attivo al bottone
    element.classList.remove('text-gray-700', 'hover:bg-gray-200');
    
    // LOGICA CORRETTA PER I NUOVI COLORI
    if (type === 'beni') {
        // Applica il BLU per i Beni (come il riquadro)
        element.classList.add('bg-blue-500', 'text-white');
    } else if (type === 'servizi') {
        // Applica il VERDE per i Servizi (come il riquadro)
        element.classList.add('bg-[#22c55e]', 'text-white');
    }
  }

// ... (codice dopo questo blocco, attorno a riga 117) ...
// ... (codice prima di questo blocco, attorno a riga 89) ...

  // NUOVA FUNZIONE: per cambiare tra scheda Beni e Servizi sulla Home
  window.switchHomeTab = function(type, element) {
    // Nasconde tutti i contenuti della Home Tab
    document.querySelectorAll('.home-tab-content').forEach(content => {
      content.classList.add('hidden');
      content.classList.remove('active');
    });
    
    // Rimuove la classe attiva da tutti i bottoni della barra
    // Ora gestisce la rimozione del BLU e del VERDE
    document.getElementById('tab-btn-beni').classList.remove('bg-blue-500', 'text-white');
    document.getElementById('tab-btn-servizi').classList.remove('bg-[#22c55e]', 'text-white'); 
    
    document.getElementById('tab-btn-beni').classList.add('text-gray-700', 'hover:bg-gray-200');
    document.getElementById('tab-btn-servizi').classList.add('text-gray-700', 'hover:bg-gray-200');

    // Mostra il contenuto corretto
    document.getElementById('home-' + type).classList.remove('hidden');
    document.getElementById('home-' + type).classList.add('active');

    // Applica lo stile attivo al bottone
    element.classList.remove('text-gray-700', 'hover:bg-gray-200');
    
    // LOGICA CORRETTA PER I NUOVI COLORI
    if (type === 'beni') {
        // Applica il BLU per i Beni (come il riquadro)
        element.classList.add('bg-blue-500', 'text-white');
    } else if (type === 'servizi') {
        // Applica il VERDE per i Servizi (come il riquadro)
        element.classList.add('bg-[#22c55e]', 'text-white');
    }
  }

// ... (codice dopo questo blocco, attorno a riga 117) ...
// ... (codice prima di questo blocco, attorno a riga 89) ...

  // NUOVA FUNZIONE: per cambiare tra scheda Beni e Servizi sulla Home
  window.switchHomeTab = function(type, element) {
    // Nasconde tutti i contenuti della Home Tab
    document.querySelectorAll('.home-tab-content').forEach(content => {
      content.classList.add('hidden');
      content.classList.remove('active');
    });
    
    // Rimuove la classe attiva da tutti i bottoni della barra
    // Ora gestisce la rimozione del BLU e del VERDE
    document.getElementById('tab-btn-beni').classList.remove('bg-blue-500', 'text-white');
    document.getElementById('tab-btn-servizi').classList.remove('bg-[#22c55e]', 'text-white'); 
    
    document.getElementById('tab-btn-beni').classList.add('text-gray-700', 'hover:bg-gray-200');
    document.getElementById('tab-btn-servizi').classList.add('text-gray-700', 'hover:bg-gray-200');

    // Mostra il contenuto corretto
    document.getElementById('home-' + type).classList.remove('hidden');
    document.getElementById('home-' + type).classList.add('active');

    // Applica lo stile attivo al bottone
    element.classList.remove('text-gray-700', 'hover:bg-gray-200');
    
    // LOGICA CORRETTA PER I NUOVI COLORI
    if (type === 'beni') {
        // Applica il BLU per i Beni (come il riquadro)
        element.classList.add('bg-blue-500', 'text-white');
    } else if (type === 'servizi') {
        // Applica il VERDE per i Servizi (come il riquadro)
        element.classList.add('bg-[#22c55e]', 'text-white');
    }
  }

// ... (codice dopo questo blocco, attorno a riga 117) ...
// ... (codice prima di questo blocco, attorno a riga 89) ...

  // NUOVA FUNZIONE: per cambiare tra scheda Beni e Servizi sulla Home
  window.switchHomeTab = function(type, element) {
    // Nasconde tutti i contenuti della Home Tab
    document.querySelectorAll('.home-tab-content').forEach(content => {
      content.classList.add('hidden');
      content.classList.remove('active');
    });
    
    // Rimuove la classe attiva da tutti i bottoni della barra
    // Ora gestisce la rimozione del BLU e del VERDE
    document.getElementById('tab-btn-beni').classList.remove('bg-blue-500', 'text-white');
    document.getElementById('tab-btn-servizi').classList.remove('bg-[#22c55e]', 'text-white'); 
    
    document.getElementById('tab-btn-beni').classList.add('text-gray-700', 'hover:bg-gray-200');
    document.getElementById('tab-btn-servizi').classList.add('text-gray-700', 'hover:bg-gray-200');

    // Mostra il contenuto corretto
    document.getElementById('home-' + type).classList.remove('hidden');
    document.getElementById('home-' + type).classList.add('active');

    // Applica lo stile attivo al bottone
    element.classList.remove('text-gray-700', 'hover:bg-gray-200');
    
    // LOGICA CORRETTA PER I NUOVI COLORI
    if (type === 'beni') {
        // Applica il BLU per i Beni (come il riquadro)
        element.classList.add('bg-blue-500', 'text-white');
    } else if (type === 'servizi') {
        // Applica il VERDE per i Servizi (come il riquadro)
        element.classList.add('bg-[#22c55e]', 'text-white');
    }
  }

// ... (codice dopo questo blocco, attorno a riga 117) ...
// ... (codice prima di questo blocco, attorno a riga 89) ...

// ... (codice prima di questo blocco, attorno a riga 89) ...

  // NUOVA FUNZIONE: per cambiare tra scheda Beni e Servizi sulla Home
  window.switchHomeTab = function(type, element) {
    // Nasconde tutti i contenuti della Home Tab
    document.querySelectorAll('.home-tab-content').forEach(content => {
      content.classList.add('hidden');
      content.classList.remove('active');
    });
    
    // Rimuove la classe attiva da tutti i bottoni della barra
    // Ora gestisce la rimozione del BLU e del VERDE
    document.getElementById('tab-btn-beni').classList.remove('bg-blue-500', 'text-white');
    document.getElementById('tab-btn-servizi').classList.remove('bg-[#22c55e]', 'text-white'); 
    
    document.getElementById('tab-btn-beni').classList.add('text-gray-700', 'hover:bg-gray-200');
    document.getElementById('tab-btn-servizi').classList.add('text-gray-700', 'hover:bg-gray-200');

    // Mostra il contenuto corretto
    document.getElementById('home-' + type).classList.remove('hidden');
    document.getElementById('home-' + type).classList.add('active');

    // Applica lo stile attivo al bottone
    element.classList.remove('text-gray-700', 'hover:bg-gray-200');
    
    // LOGICA CORRETTA PER I NUOVI COLORI
    if (type === 'beni') {
        // Applica il BLU per i Beni (come il riquadro)
        element.classList.add('bg-blue-500', 'text-white');
    } else if (type === 'servizi') {
        // Applica il VERDE per i Servizi (come il riquadro)
        element.classList.add('bg-[#22c55e]', 'text-white');
    }
  }

// ... (codice dopo questo blocco, attorno a riga 117) ...
>
  // --- 1. IMPORTAZIONI COMPLETE FIREBASE ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  // Importazioni per l'Autenticazione (Login Google)
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
  // Importazioni per il Database (Firestore - Interazioni/Pubblicazione)
  // AGGIUNTE: doc, deleteDoc e updateDoc
  import { getFirestore, collection, addDoc, query, onSnapshot, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";


  // Your web app's Firebase configuration (I tuoi dati restano invariati)
  const firebaseConfig = {
    apiKey: "AIzaSyCTwU75eJLGpuz5jw_gkhHdgYrHUkN__AY",
    authDomain: "ecomunity-app.firebaseapp.com",
    projectId: "ecomunity-app",
    storageBucket: "ecomunity-app.firebasestorage.app",
    messagingSenderId: "788175207861",
    appId: "1:788175207861:web:e3f159da01c096e0d3edfc"
  };

  // Inizializza Firebase
  const app = initializeApp(firebaseConfig);
  
  // --- 2. INIZIALIZZAZIONE SERVIZI FIREBASE ---
  const auth = getAuth(app); // Servizio di Autenticazione
  const db = getFirestore(app); // Servizio Database Firestore
  const googleProvider = new GoogleAuthProvider(); // Provider per Google Login
  
  // Variabile per tenere traccia del tipo di offerta (bene o servizio)
  let currentOfferType = 'bene';

  // --- FUNZIONI DI GESTIONE UI ---
  
  // Funzione per cambiare schermata
  function switchScreen(screenId) {
    document.querySelectorAll('.screen').forEach(screen => {
      screen.classList.remove('active');
    });
    const screenToShow = document.getElementById(screenId);
    if (screenToShow) {
        screenToShow.classList.add('active');
        // Nasconde sempre la schermata di login quando si entra nell'app
        document.getElementById('login-screen').style.display = 'none'; 
    }
  }

  // Funzione per gestire i click sulla Tab Bar
  window.navigate = function(screenId, element) {
    switchScreen(screenId);
    // Aggiorna lo stato "attivo" della tab bar
    document.querySelectorAll('.tab-item').forEach(item => {
        item.classList.remove('active');
    });
    element.classList.add('active');
  }

  // Funzione per il toggle del tipo di offerta nella schermata di Pubblicazione
  window.toggleOfferType = function(type) {
    currentOfferType = type;
    document.getElementById('type-bene').classList.remove('bg-[#22c55e]', 'text-white');
    document.getElementById('type-servizio').classList.remove('bg-[#22c55e]', 'text-white');
    document.getElementById('type-bene').classList.add('text-gray-700', 'hover:bg-gray-200');
    document.getElementById('type-servizio').classList.add('text-gray-700', 'hover:bg-gray-200');

    if (type === 'bene') {
        document.getElementById('type-bene').classList.add('bg-[#22c55e]', 'text-white');
    } else {
        document.getElementById('type-servizio').classList.add('bg-[#22c55e]', 'text-white');
    }
  }

  // NUOVA FUNZIONE: per cambiare tra scheda Beni e Servizi sulla Home
  window.switchHomeTab = function(type, element) {
    // Nasconde tutti i contenuti della Home Tab
    document.querySelectorAll('.home-tab-content').forEach(content => {
      content.classList.add('hidden');
      content.classList.remove('active');
    });
    
    // Rimuove la classe attiva da tutti i bottoni della barra
    document.getElementById('tab-btn-beni').classList.remove('bg-[#22c55e]', 'text-white');
    document.getElementById('tab-btn-servizi').classList.remove('bg-[#22c55e]', 'text-white');
    document.getElementById('tab-btn-beni').classList.add('text-gray-700', 'hover:bg-gray-200');
    document.getElementById('tab-btn-servizi').classList.add('text-gray-700', 'hover:bg-gray-200');

    // Mostra il contenuto corretto
    document.getElementById('home-' + type).classList.remove('hidden');
    document.getElementById('home-' + type).classList.add('active');

    // Applica lo stile attivo al bottone
    element.classList.remove('text-gray-700', 'hover:bg-gray-200');
    element.classList.add('bg-[#22c55e]', 'text-white');
  }


  // --- 3. FUNZIONE DI AUTENTICAZIONE GOOGLE ---
  // Funzione chiamata dal pulsante di login (aggiunta a window per l'onclick)
  window.handleAuth = async function() {
    try {
        const result = await signInWithPopup(auth, googleProvider);
        // L'utente si è loggato con successo. onAuthStateChanged gestirà l'UI.
        console.log("Accesso Google completato per:", result.user.displayName);
    } catch (error) {
        // Gestione degli errori (es. l'utente ha chiuso il popup)
        console.error("Errore di Autenticazione:", error.code, error.message);
        if (error.code !== 'auth/popup-closed-by-user') {
            alert("Errore di accesso. Riprova: " + error.message);
        }
    }
  };

  // Funzione di Logout (da collegare a un pulsante nella schermata Profilo)
  window.handleLogout = async function() {
      await signOut(auth);
      console.log("Utente disconnesso.");
      // onAuthStateChanged gestirà il reindirizzamento alla schermata di Login
  }


  // --- 4. GESTIONE STATO UTENTE (ON LOAD) ---
  // Controlla lo stato di autenticazione all'avvio dell'app
  onAuthStateChanged(auth, (user) => {
    // 1. Nasconde la schermata di caricamento
    document.getElementById('loading-screen').style.display = 'none';
    document.getElementById('app-container').classList.remove('hidden');
    
    if (user) {
        // Utente loggato (Registrato o Ri-loggato)
        console.log("Utente attivo:", user.uid, user.displayName);

        // **MODIFICHE PER GARANTIRE LA VISIBILITÀ SU TUTTI I BROWSER**
        document.getElementById('app-header').style.display = 'block'; 
        document.getElementById('tab-bar').style.display = 'flex'; 
        
        // Aggiorna l'UI del profilo se necessario (es. nome utente)
        document.getElementById('profile-name').textContent = user.displayName || "Utente EcoMunity";
        
        // Passa alla schermata Home e attiva l'icona
        switchScreen('home-screen');
        document.getElementById('nav-home').classList.add('active');

        // Carica le offerte dal database
        loadOffers(); 

    } else {
        // Utente NON loggato
        console.log("Nessun utente loggato. Mostra schermata di Login.");
        // Mostra la schermata di Login (deve essere in display:flex per il centraggio)
        document.getElementById('login-screen').style.display = 'flex';
        // Nasconde l'header e la tab bar quando non loggato
        document.getElementById('app-header').style.display = 'none';
        document.getElementById('tab-bar').style.display = 'none';
    }
  });


  // --- 5. INTERAZIONE DATABASE (ESEMPIO DI PUBBLICAZIONE) ---
  // Funzione per salvare una nuova offerta su Firestore
  window.publishOffer = async function(event) {
    event.preventDefault(); // Impedisce il ricaricamento della pagina
    
    // Recupera i dati del form
    const title = document.getElementById('title').value;
    const description = document.getElementById('description').value;
    
    // Ottieni l'utente corrente per associare l'offerta
    const user = auth.currentUser;
    if (!user) {
        alert("Devi essere loggato per pubblicare un'offerta.");
        return;
    }

    try {
        const docRef = await addDoc(collection(db, "offerte"), {
            title: title,
            description: description,
            type: currentOfferType, // 'bene' o 'servizio'
            ownerId: user.uid,
            ownerName: user.displayName,
            timestamp: new Date(),
            status: 'available'
        });
        
        console.log("Documento scritto con ID: ", docRef.id);
        alert("Offerta pubblicata con successo!");
        
        // Reset del form e navigazione alla home
        document.getElementById('publish-form').reset();
        window.navigate('home-screen', document.getElementById('nav-home'));

    } catch (e) {
        console.error("Errore durante l'aggiunta del documento: ", e);
        alert("Errore durante la pubblicazione. Controlla la console.");
    }
  }

  // NUOVA FUNZIONE: ELIMINA OFFERTA
  window.deleteOffer = async function(docId) {
      if (confirm("Sei sicuro di voler eliminare questa offerta? L'azione è irreversibile.")) {
          try {
              // Trova il riferimento al documento e lo elimina
              await deleteDoc(doc(db, "offerte", docId));
              console.log("Documento eliminato con ID: ", docId);
              alert("Offerta eliminata con successo!");
              // L'aggiornamento UI è automatico grazie a onSnapshot in loadOffers
          } catch (e) {
              console.error("Errore durante l'eliminazione del documento: ", e);
              alert("Errore durante l'eliminazione. Controlla le regole di sicurezza (write).");
          }
      }
  }
  
  // NUOVA FUNZIONE: MODIFICA OFFERTA (funzionalità iniziale)
  window.editOffer = function(docId, title, description) {
      alert("Funzione di modifica avviata. Caricamento dati annuncio: " + title);
      // **NOTA BENE:** Per l'implementazione completa:
      // 1. Dovresti creare un form Modale o reindirizzare alla schermata di Pubblicazione.
      // 2. Pre-compilare i campi 'title' e 'description' con i valori passati.
      // 3. Creare una funzione 'updateOffer' che usa updateDoc(docRef, { ...nuovidati... }).
      
      console.log("ID da modificare:", docId);
      console.log("Titolo attuale:", title);
  }


  // --- 6. INTERAZIONE DATABASE (ESEMPIO DI LETTURA) ---
  // Funzione per leggere e popolare le offerte
  function loadOffers() {
      // Ottieni l'utente loggato
      const currentUser = auth.currentUser;
      const currentUserId = currentUser ? currentUser.uid : null;
      
      // Inizia l'ascolto in tempo reale sulla collezione 'offerte'
      const q = query(collection(db, "offerte"));
      
      onSnapshot(q, (querySnapshot) => {
          let beniHtml = '';
          let serviziHtml = '';
          
          querySnapshot.forEach((document) => {
              const offer = document.data();
              const docId = document.id; // Ottieni l'ID del documento
              const isOwner = currentUserId && offer.ownerId === currentUserId; // Controlla se è il proprietario

              // COSTRUZIONE DINAMICA DEI PULSANTI
              const ownerButtons = isOwner ? `
                  <div class="flex space-x-2 mt-2">
                      <button onclick="editOffer('${docId}', \`${offer.title}\`, \`${offer.description}\`)" 
                          class="px-2 py-1 text-xs bg-yellow-500 text-white font-medium rounded-full hover:bg-yellow-600 transition">
                          Modifica
                      </button>
                      <button onclick="deleteOffer('${docId}')" 
                          class="px-2 py-1 text-xs bg-red-500 text-white font-medium rounded-full hover:bg-red-600 transition">
                          Elimina
                      </button>
                  </div>
              ` : '';

              // PULSANTE 'CONTATTA' (mostrato solo se NON è il proprietario)
              const contactButton = isOwner ? '' : `
                  <button class="px-3 py-1 bg-green-500 text-white text-sm font-medium rounded-full hover:bg-green-600 transition">
                      Contatta
                  </button>
              `;

              // Costruisci il blocco HTML per l'offerta
              const offerHtml = `
                <div class="bg-white p-4 rounded-lg shadow-sm flex justify-between items-start border border-gray-200">
                    <div>
                        <p class="font-semibold text-lg">${offer.title}</p>
                        <p class="text-sm text-gray-500">${offer.description}</p>
                        <p class="text-xs text-gray-400 mt-1">Offerto da: ${offer.ownerName}</p>
                        ${ownerButtons}
                    </div>
                    ${contactButton}
                </div>
              `;

              if (offer.type === 'bene') {
                  beniHtml += offerHtml;
              } else if (offer.type === 'servizio') {
                  serviziHtml += offerHtml;
              }
          });

          // Aggiorna l'HTML della Home Screen
          document.getElementById('item-list-bene').innerHTML = beniHtml;
          document.getElementById('item-list-servizio').innerHTML = serviziHtml;
          document.getElementById('empty-bene').style.display = beniHtml ? 'none' : 'block';
          document.getElementById('empty-servizio').style.display = serviziHtml ? 'none' : 'block';
      });
  }

</script>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        
        /* Stili per la Tab Bar (Navbar Mobile) - Aumentata a 72px per sicurezza */
        #tab-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 72px; /* Aumentato per evitare tagli */
            background-color: #ffffff;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
        }
        .tab-item {
            color: #6b7280; /* Grigio neutrale */
            transition: all 0.2s;
        }
        .tab-item.active {
            color: #22c55e; /* Verde smeraldo vivo per l'attivo */
        }
        .screen {
            display: none;
            padding-bottom: 80px; /* Spazio per la tab bar da 72px + padding */
            min-height: calc(100vh - 72px - 64px); /* Calcola altezza utile per mobile */
            padding-top: 1rem;
        }
        .screen.active {
            display: block;
        }
        /* Stile specifico per il pulsante di blocco (Principiante) */
        .purchase-blocked {
            cursor: not-allowed;
            opacity: 0.6;
        }
        .app-header {
            background-color: #22c55e;
            color: white;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 40;
        }
        .ecomunity-logo {
            display: inline-flex;
            align-items: center;
        }
        .ecomunity-logo svg {
            margin-right: 0.5rem;
        }
        
        /* >>> INIZIO NUOVO CODICE CSS DA COPIARE/INCOLLARE QUI <<< */
        
        /* Stile per nascondere/mostrare le schede Home interne */
        .home-tab-content.hidden {
            display: none;
        }
        .home-tab-content.active {
            display: block;
        }

        /* >>> FINE NUOVO CODICE CSS DA COPIARE/INCOLLARE QUI <<< */
    </style>
</head>
<body class="antialiased text-gray-800">


    <div id="app-header" class="app-header">
        <div class="flex justify-between items-center">
             <div class="text-2xl font-black tracking-wide ecomunity-logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-leaf"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.1 10.4 17 10.8 21 12c-3.1 1.7-6.4 2.1-11 0a2 2 0 0 0-1.7 2.9c.7 2.8-.8 6.5-4.2 7A7 7 0 0 1 11 20"/></svg>
                EcoMunity
            </div>
            <button onclick="handleLogout()" class="text-sm font-medium py-1 px-3 border border-white rounded-full hover:bg-white hover:text-[#22c55e] transition duration-150">
                Esci
            </button>
        </div>
    </div>

    <div id="loading-screen" class="fixed inset-0 bg-white flex flex-col items-center justify-center p-6 z-50">
        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-[#22c55e] mb-4"></div>
        <p class="text-gray-600 text-lg">Caricamento dati EcoMunity...</p>
        <p class="text-sm text-gray-400 mt-2">(Tentativo di Autenticazione Automatica)</p>
    </div>

    <div id="app-container" class="p-4 hidden">

        <div id="login-screen" class="screen fixed inset-0 bg-gray-50 flex-col items-center justify-center p-6 z-50" style="display: none;">
            <div class="max-w-sm w-full bg-white p-8 shadow-2xl rounded-xl text-center border border-gray-100">
                <h2 class="text-3xl font-extrabold text-[#22c55e] mb-2 ecomunity-logo justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-leaf"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.1 10.4 17 10.8 21 12c-3.1 1.7-6.4 2.1-11 0a2 2 0 0 0-1.7 2.9c.7 2.8-.8 6.5-4.2 7A7 7 0 0 1 11 20"/></svg>
                    EcoMunity
                </h2>
                <p class="text-gray-600 mb-8">Un'economia circolare basata sulla fiducia e sul Karma.</p>

                <div class="space-y-4">
                    <button id="login-button" onclick="handleAuth()" class="w-full flex items-center justify-center px-6 py-3 border border-gray-300 rounded-xl shadow-md text-base font-medium text-gray-700 bg-white hover:bg-gray-50 transition duration-150">
                        <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M43.61 20.0833H42V20H24V28H36.443C35.213 31.865 31.547 34.667 27 34.667C20.667 34.667 15.667 29.667 15.667 23.333C15.667 16.999 20.667 11.999 27 11.999C30.067 11.999 32.867 13.199 34.867 15.199L40.033 10.033C36.467 6.467 31.9 4.667 27 4.667C13.667 4.667 4.667 13.667 4.667 23.333C4.667 32.999 13.667 41.999 27 41.999C35.533 41.999 43.067 36.333 43.61 28.167V20.0833Z" fill="#FFC107" />
                            <path d="M43.61 20.0833H42V20H24V28H36.443C35.213 31.865 31.547 34.667 27 34.667C20.667 34.667 15.667 29.667 15.667 23.333C15.667 16.999 20.667 11.999 27 11.999C30.067 11.999 32.867 13.199 34.867 15.199L40.033 10.033C36.467 6.467 31.9 4.667 27 4.667C13.667 4.667 4.667 13.667 4.667 23.333C4.667 32.999 13.667 41.999 27 41.999C35.533 41.999 43.067 36.333 43.61 28.167V20.0833Z" fill="#4285F4" />
                            <path d="M15.667 23.333C15.667 29.667 20.667 34.667 27 34.667C31.547 34.667 35.213 31.865 36.443 28H27V20H15.667V23.333Z" fill="#34A853" />
                            <path d="M43.61 20.0833H42V20H24V28H36.443C36.014 26.177 36.014 24.167 36.014 24.167C36.014 24.167 36.014 22.157 36.443 20.0833Z" fill="#FBC02D" />
                        </svg>
                        Accedi con Google (Obbligatorio)
                    </button>
                    <p class="text-xs text-gray-500 pt-4">Assicuriamo l'onestà richiedendo un'identità verificata.</p>
                </div>
            </div>
        </div>


                <div id="home-screen" class="screen active">
            <div class="flex space-x-2 p-1 bg-gray-100 rounded-lg mb-4">
                <button type="button" onclick="switchHomeTab('beni', this)" id="tab-btn-beni" class="flex-1 py-2 text-center rounded-lg font-bold bg-[#22c55e] text-white transition duration-150">
                    Beni (Oggetti)
                </button>
                <button type="button" onclick="switchHomeTab('servizi', this)" id="tab-btn-servizi" class="flex-1 py-2 text-center rounded-lg font-bold text-gray-700 hover:bg-gray-200 transition duration-150">
                    Servizi (Banca Ore)
                </button>
            </div>
            
            <div id="home-beni" class="home-tab-content active">
                <div class="mb-4 p-4 rounded-xl bg-blue-50 border-2 border-blue-200">
                    <h3 class="text-lg font-extrabold text-blue-800 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package-check mr-2"><path d="m16 16 2 2 4-4"/><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                        Beni in Scambio
                    </h3>
                    <div id="item-list-bene" class="space-y-4">
                        </div>
                    <p id="empty-bene" class="text-sm text-gray-500 text-center mt-4 hidden">Nessun bene disponibile al momento. Pubblicane uno!</p>
                </div>
            </div>
            
            <div id="home-servizi" class="home-tab-content hidden">
                <div class="p-4 rounded-xl bg-green-50 border-2 border-green-200">
                    <h3 class="text-lg font-extrabold text-green-800 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-timer mr-2"><path d="M10 2h4"/><path d="M12 14v-4"/><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12h2a8 8 0 0 0 8 8 8 8 0 0 0 8-8z"/></svg>
                        Servizi (Banca Ore)
                    </h3>
                    <div id="item-list-servizio" class="space-y-4">
                        </div>
                    <p id="empty-servizio" class="text-sm text-gray-500 text-center mt-4 hidden">Nessun servizio disponibile al momento. Pubblicane uno!</p>
                </div>
            </div>
            
        </div>

        <div id="publish-screen" class="screen">
            <h2 class="text-xl font-bold mb-6 text-gray-700">Pubblica la Tua Offerta</h2>
            <form id="publish-form" onsubmit="publishOffer(event)" class="space-y-6 bg-white p-6 rounded-xl shadow-lg border border-gray-100">

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cosa stai offrendo?</label>
                    <div class="flex space-x-4 p-1 bg-gray-100 rounded-lg">
                        <button type="button" onclick="toggleOfferType('bene')" id="type-bene" class="flex-1 py-2 text-center rounded-lg font-medium bg-[#22c55e] text-white transition duration-150">Bene (Oggetto)</button>
                        <button type="button" onclick="toggleOfferType('servizio')" id="type-servizio" class="flex-1 py-2 text-center rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition duration-150">Servizio (Banca Ore)</button>
                    </div>
                </div>

                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700">Titolo dell'Offerta</label>
                    <input type="text" id="title" required class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 focus:ring-[#22c55e] focus:border-[#22c55e]" placeholder="Esempio: Bicicletta da città usata">
                </div>
                
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">Descrizione Dettagliata</label>
                    <textarea id="description" rows="4" required class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 focus:ring-[#22c55e] focus:border-[#22c55e]" placeholder="Descrivi l'oggetto o il servizio. Sii chiaro su cosa cerchi in cambio."></textarea>
                </div>
                
                <button type="submit" class="w-full bg-[#22c55e] text-white font-bold py-3 px-4 rounded-xl hover:bg-green-600 transition duration-150 shadow-md">
                    Pubblica Offerta
                </button>
            </form>
        </div>
        
        <div id="profile-screen" class="screen">
            <h2 class="text-xl font-bold mb-6 text-gray-700">Il Tuo Profilo</h2>
            
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 space-y-4">
                <p class="text-2xl font-bold text-[#22c55e]" id="profile-name">Caricamento...</p>
                <p class="text-sm text-gray-600">Karma Attuale: <span class="font-bold text-yellow-600">50 (Principiante)</span></p>
                
                <h3 class="font-semibold text-gray-700 pt-4">Le Tue Offerte Pubblicate</h3>
                <div class="space-y-3">
                    <p class="text-sm text-gray-500">Nessuna offerta attiva. Pubblicane una!</p>
                </div>
            </div>
            
            <button onclick="handleLogout()" class="mt-6 w-full py-3 text-red-600 border border-red-200 rounded-xl hover:bg-red-50 transition duration-150">
                Disconnetti Account
            </button>
        </div>
        
    </div>
    
    <div id="tab-bar">
        <button class="tab-item active" id="nav-home" onclick="navigate('home-screen', this)">
            <div class="flex flex-col items-center p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="12" y2="12"/><line x1="12" x2="12" y1="3" y2="21"/></svg>
                <span class="text-xs mt-1">Home</span>
            </div>
        </button>
        
        <button class="tab-item" id="nav-publish" onclick="navigate('publish-screen', this)">
            <div class="flex flex-col items-center p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>
                <span class="text-xs mt-1">Pubblica</span>
            </div>
        </button>
        
        <button class="tab-item" id="nav-chat" onclick="alert('La schermata Chat non è ancora implementata!')">
            <div class="flex flex-col items-center p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                <span class="text-xs mt-1">Chat</span>
            </div>
        </button>
        
        <button class="tab-item" id="nav-profile" onclick="navigate('profile-screen', this)">
            <div class="flex flex-col items-center p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <span class="text-xs mt-1">Profilo</span>
            </div>
        </button>
    </div>

</body>
</html>
